import { PrimaryButton } from '@buttons/primary/PrimaryButton';
import SimpleSection from '@defaults/SimpleSection';
import { CodefendLogo } from '@icons';
import type { Webresource } from '@interfaces/index';
import { useOrderStore } from '@stores/orders.store';
import useTableStoreV3 from '@table/v3/tablev3.store';
import { formatNumber } from '@utils/helper';
import { flattenRows } from '@utils/sort.service';
import type { FC } from 'react';

interface WebApplicationPentestProps {
	webResources: Webresource[];
	isLoading: boolean;
}

const WebApplicationPentest: FC<WebApplicationPentestProps> = ({
	webResources,
	isLoading,
}) => {
	const { selectedItems } = useTableStoreV3();
	const { updateState } = useOrderStore((state) => state);
	const resourceCount = selectedItems.length;
	const resourceSelected: Webresource[] = flattenRows(webResources).filter(
		(resource) => selectedItems.includes(resource.id),
	);
	const subDomainCount = resourceSelected.filter(
		(resource) => resource.resource_domain_dad !== '',
	).length;
	const domainCount = resourceSelected.length - subDomainCount;

	const title = !Boolean(resourceCount)
		? 'No resources selected'
		: 'Recommend plan: full';

	const firstText = !Boolean(resourceCount)
		? 'Please select the desired resources in'
		: `Selected: ${domainCount} domain + ${subDomainCount} sub domains`;
	const secondText = !Boolean(resourceCount)
		? 'order to start a new pentest'
		: `Final price: $${formatNumber('13000')}`;
	return (
		<div className="card launch-pentest-card">
			<SimpleSection header="Launch a new pentest" icon={<CodefendLogo />}>
				<div className="content">
					<div className="pentest-info-container">
						<img src="/codefend/____fav.png" alt="Request a pentest" />
						<div className="main-info-container">
							<h3 className="codefend-text-red">{title}</h3>
							<p>
								<span>{firstText}</span>
								<span>{secondText}</span>
							</p>
						</div>
					</div>
					<PrimaryButton
						text="REQUEST AUTOMATED SCAN"
						click={() => updateState('open', true)}
						className="pentest-btn"
						isDisabled={selectedItems.length === 0 || isLoading}
						disabledLoader
					/>
				</div>
			</SimpleSection>
		</div>
	);
};

export default WebApplicationPentest;
